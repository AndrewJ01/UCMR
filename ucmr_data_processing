# Andrew Black
# andrewjblack0@gmail.com

# test change for new branch
# ctrl-shift-w to close all View tabs
# ctrl-/ to comment-out a section

# List out packages
	packages = c("ggplot2",
						"readxl",
						 "readr",
						 "tidyr",
						 "UpSetR",
						 "dplyr",
						 "purrr",
						 "stringr",
						 "ComplexUpset",
						 "apaTables",
						 "sos",
						 "imputeTS",
						 "ggmap",
						 "readtext",
						 "expss",
						 "ggsci",
						 "tmaptools",
						 "usmap",
						 "knitr",
						 "afex",
						 "stringr",
						 "ggthemes",
						 "scales",
						 "grid",
						 "reshape2")


	# Now load or install&load all
		package.check <- lapply(
		  packages,
		  FUN = function(x) {
		    if (!require(x, character.only = TRUE)) {
		      install.packages(x, dependencies = TRUE)
		      library(x, character.only = TRUE)
		    }
		  }
		)

# Set up colors for the colorblind
	scale_colour_discrete <- scale_colour_colorblind

# Navigate to the first file and open it
	setwd("C:/Users/Andrew/Desktop/UCMR")

# Get EPA data combined into one dataframe
	# Open .txt files provided in UCMR3 zip folder from EPA
		
		# UCMR3 All occurrence data
			UCMR3_allData <- read.table("UCMR3_All.txt", fill=TRUE, header=TRUE, quote="", sep="\t", encoding="UTF-8")
			#View(UCMR3_allData)
			unique(UCMR3_allData$State) # Wooooh, got all states and some territories!

			UCMR3_allData <- UCMR3_allData[!with(UCMR3_allData,is.na(MRL)& is.na(AnalyticalResultValue)& is.na(Contaminant)),] # remove rows where MRL is NA AND AnalyticalResultValue is NA, because this is not even a ND, there is no contaminant test reported
			
			UCMR3_allData$PWSID_facilityID <- paste(UCMR3_allData$PWSID, UCMR3_allData$FacilityID, sep="")
			UCMR3_allData$PWSID_facilty_water <- paste(UCMR3_allData$PWSID, UCMR3_allData$FacilityWaterType, sep="")
			#View(UCMR3_allData)

		# UCMR3 disinfectant use data
			UCMR3_DT <- read.table("UCMR3_DT.txt", fill=TRUE, header=TRUE, quote="", sep="\t", encoding="UTF-8")
			#View(UCMR3_DT)
			UCMR3_DT$PWSID_facilityID <- paste(UCMR3_DT$PWSID, UCMR3_DT$FacilityID, sep="")
			# Remove the columns that are not needed, sample event code and collection date
			UCMR3_DT <- UCMR3_DT[, c("PWSID_facilityID", "Disinfectant.Type")]
			# Remove duplicate rows
			UCMR3_DT <- unique(UCMR3_DT)
			

			# this means that we must match up the disinfectant data based on BOTH PWSID and FacilityID, because a given PWSID may have multiple facilities under it, and the state-assigned facility ID has been proven not-unique (so, a PWSID from Kansas and Florida may have the same facility number 771, under unique PWSIDs)
			
			UCMR3_disinf <- left_join(UCMR3_allData, UCMR3_DT, by = "PWSID_facilityID")
			#View(UCMR3_disinf)

		# Get a nice list of the column names
			dput(as.character(names(UCMR3_disinf)))

	# Look at UCMR4 EPA data, get look up values for these PWSIDs treatment info
		# Open .txt files provided in UCMR3 zip folder from EPA
		UCMR4_HAA_AddtlDataElem <- read.delim("UCMR4_HAA_AddtlDataElem.txt")
		#View(UCMR4_HAA_AddtlDataElem)

		# make the column AdditionalDataElement into separate columns with Response below each
			UCMR4_HAA_AddtlDataElem_wide <- UCMR4_HAA_AddtlDataElem %>%
					  group_by(AdditionalDataElement) %>%
					  mutate(row = row_number()) %>%
					  tidyr::pivot_wider(names_from = AdditionalDataElement, values_from = Response) %>%
					  select(-row)
			#View(UCMR4_HAA_AddtlDataElem_wide)
		UCMR4_HAA_AddtlDataElem_wide$PWSID_facilityID <- paste(UCMR4_HAA_AddtlDataElem_wide$PWSID, UCMR4_HAA_AddtlDataElem_wide$FacilityID, sep="")


		# Make a table of treatment info by PWSID
			UCMR4_HAA_AddtlDataElem_wide_1 <- unique(subset(UCMR4_HAA_AddtlDataElem_wide, select = c("PWSID_facilityID", "TreatmentInformation")))
			UCMR4_HAA_AddtlDataElem_wide_1 <- na.omit(UCMR4_HAA_AddtlDataElem_wide_1)
			#View(UCMR4_HAA_AddtlDataElem_wide_1)
			PWSID_TreatmentInfo <- UCMR4_HAA_AddtlDataElem_wide_1 %>% 
			    group_by(PWSID_facilityID) %>% 
			    summarise(Treatment = paste(unique(TreatmentInformation), collapse = ', '))
			#View(PWSID_TreatmentInfo)

			# see how many of these from original UCMR4 set have biofiltration
			PWSID_TreatmentInfo_BF <- PWSID_TreatmentInfo
			PWSID_TreatmentInfo_BF$Biofiltration <- ifelse(is.na(PWSID_TreatmentInfo$Treatment), NA, grepl("BIO", PWSID_TreatmentInfo$Treatment))
			PWSID_TreatmentInfo_BF <- merge(x = PWSID_TreatmentInfo_BF, y = UCMR4_HAA_AddtlDataElem_wide[ , c("PWSID", "FacilityID", "PWSID_facilityID")], by.x = 'PWSID_facilityID', by.y = 'PWSID_facilityID')
			# Make it only unique rows
			PWSID_TreatmentInfo_BF <- unique(PWSID_TreatmentInfo_BF)
			#View(PWSID_TreatmentInfo_BF) # There are 7,326 unique facilities with treatment info from UCMR4

			# Of these, how many PWSIDs have different BF status within their included facilities? Filter out to just PWSID and Biofiltration and set to unique, then check for duplicate PWSIDs in that column
			unique_PWSID_BF <- unique(subset(PWSID_TreatmentInfo_BF, select = c("PWSID", "Biofiltration")))
			#View(unique_PWSID_BF) # 4,418 unique combinations of PWSID and Biofiltration. How many unique PWSIDs then?
			length(unique(unique_PWSID_BF$PWSID)) # 4,415 so thats only 3 differences. Thats nothing!

			# see how many of these from original UCMR4 set have GAC
			PWSID_TreatmentInfo_GAC <- PWSID_TreatmentInfo_BF
			PWSID_TreatmentInfo_GAC$GAC <- ifelse(is.na(PWSID_TreatmentInfo_BF$Treatment), NA, grepl("GAC", PWSID_TreatmentInfo_BF$Treatment))
			PWSID_TreatmentInfo_GAC <- merge(x = PWSID_TreatmentInfo_GAC, y = UCMR4_HAA_AddtlDataElem_wide[ , c("PWSID", "FacilityID", "PWSID_facilityID")], by.x = 'PWSID_facilityID', by.y = 'PWSID_facilityID')
			# Make it only unique rows
			PWSID_TreatmentInfo_GAC <- unique(PWSID_TreatmentInfo_GAC)
			#View(PWSID_TreatmentInfo_GAC) # There are 7,326 unique facilities with treatment info from UCMR4

			# Of these, how many PWSIDs have different GAC status within their included facilities? Filter out to just PWSID and GAC and set to unique, then check for duplicate PWSIDs in that column
			unique_PWSID_GAC <- unique(subset(PWSID_TreatmentInfo_GAC, select = c("PWSID.x", "GAC")))
			#View(unique_PWSID_GAC) # 4,433 unique combinations of PWSID and GAC. How many unique PWSIDs then?
			length(unique(unique_PWSID_GAC$PWSID)) # 4,415 so thats only 18 differences. Thats not much!


			# Okay, combine this info later based on PWSID and see how many NAs. Pick this up again further down in this script...
			treatment_data <- subset(PWSID_TreatmentInfo_GAC, select = c("PWSID.x", "FacilityID.x", "PWSID_facilityID", "Treatment", "Biofiltration", "GAC"))
			names(treatment_data)[names(treatment_data)=="PWSID.x"] <- "PWSID"
			names(treatment_data)[names(treatment_data)=="FacilityID.x"] <- "FacilityID"
			#View(treatment_data)



# Merge this new dataframes to original UCMR3 dataframe, first by PWSID_facilityID and count NAs
		UCMR3_w_treatment_data1 <- left_join(UCMR3_allData, treatment_data, by='PWSID_facilityID') # left_join keeps the "by" from the first listed dataframe, and fills in from the next dataframe to match up to PWSID_facilityIDs
		#View(UCMR3_w_treatment_data1)
		sum(is.na(UCMR3_w_treatment_data1$Biofiltration))
		sum(is.na(UCMR3_w_treatment_data1$GAC))
		

# Repeat by matching first PWSID then facility ID
		UCMR3_w_treatment_data2 <- left_join(UCMR3_allData, treatment_data, by= c('PWSID', 'FacilityID')) # left_join keeps the "by" from the first listed dataframe, and fills in from the next dataframe to match up to PWSID_facilityIDs
		#View(UCMR3_w_treatment_data2)
		sum(is.na(UCMR3_w_treatment_data2$Biofiltration))
		sum(is.na(UCMR3_w_treatment_data2$GAC))

# Repeat by matching just PWSID
		UCMR3_w_treatment_data3 <- left_join(UCMR3_allData, treatment_data, by= 'PWSID') # left_join keeps the "by" from the first listed dataframe, and fills in from the next dataframe to match up to PWSID_facilityIDs
		#View(UCMR3_w_treatment_data3)
		sum(is.na(UCMR3_w_treatment_data3$Biofiltration))
		sum(is.na(UCMR3_w_treatment_data3$GAC))

# This gave us 1,044,447 NA's for set 1 and 2, but only 254,102 NA's for set 3. Can we confirm that it is accurate to assign this info by PWSID, not facility ID? Yes, there were only 3 and 18 mismatches for BIO and GAC, respectively. So only 21 PWSIDs had different responses for these two within their included facilities. Lets go with set 3!

		final_data <- UCMR3_w_treatment_data3
		#View(final_data)

# Add geolocation data to this, by PWSID

		PWSID_latlong <- read_csv("C:/Users/Andrew/Desktop/AJB_personal/USF/Masters_thesis_word/UCMR_3_dioxane/SDWIS_lat_long_toR.csv")
		final_data_latlong <- dplyr::left_join(final_data, PWSID_latlong, by = "PWSID")
		#View(final_data_latlong)

		# Count how many are still missing
		unique_PWSIDs <- unique(subset(final_data_latlong, select = c("PWSID", "LAT", "LONG")))
		unique_facilities <- unique(subset(final_data_latlong, select = c("PWSID", "FacilityID.x", "LAT", "LONG")))
		length(unique_PWSIDs$LAT) # 6,201 unique PWSs geolocated
		sum(is.na(unique_PWSIDs$LAT)) # 783 missing geolocations out of 6,201 PWSIDs
		length(unique_facilities$LAT) # 22,134 unique facilities geolocated
		sum(is.na(unique_facilities$LAT)) # 1,231 missing geolocations out of 22,134 facilities

# Find out how many unique facilities included in UCMR3 data report biofiltration, first selecting only the PWSID and then showing only unique ones and counting the ones with and without BIO and the NAs
		final_data_check_bio <- unique(subset(final_data_latlong, select = c("PWSID", "FacilityID.x", "Biofiltration")))
		length(final_data_check_bio$PWSID) # 22,156 total unique facilities

		facilities_with_bio <- dplyr::filter(final_data_check_bio, Biofiltration == TRUE)
		length(facilities_with_bio$Biofiltration) # 405 facilities report biofiltration
		
		facilities_wo_bio <- dplyr::filter(final_data_check_bio, Biofiltration == FALSE)
		length(facilities_wo_bio$Biofiltration) # 15,658 facilities report no biofiltration
		
		sum(is.na(final_data_check_bio$Biofiltration)) # 6,093 do not report


# Find out how many unique facilities included in UCMR3 data report GAC, first selecting only the PWSID and then showing only unique ones and counting the ones with and without BIO and the NAs
		final_data_check_GAC <- unique(subset(final_data_latlong, select = c("PWSID", "FacilityID.x", "GAC")))
		length(final_data_check_GAC$PWSID) # 22,725 total unique facilities

		facilities_with_GAC <- dplyr::filter(final_data_check_GAC, GAC == TRUE)
		length(facilities_with_GAC$GAC) # 405 facilities report GAC
		
		facilities_wo_GAC <- dplyr::filter(final_data_check_GAC, GAC == FALSE)
		length(facilities_wo_GAC$GAC) # 15,658 facilities report no GAC
		
		sum(is.na(final_data_check_GAC$GAC)) # 6,093 do not report

# Filter contaminant for 1,4-dioxane, strontium, PFOS, PFOA, and 1,2,3-trichloropropane
	final_data_regdet <- dplyr::filter(final_data_latlong,
										Contaminant == "1,4-dioxane" |
										Contaminant == "PFOS" |
										Contaminant == "PFOA" |
										Contaminant == "strontium" |
										Contaminant == "1,2,3-trichloropropane")
# Remove duplicate columns and rename some
		# Get a nice list of the column names
			#dput(as.character(names(final_data_regdet)))
	final_data_regdet <- subset(final_data_regdet, select = c("PWSID", "PWSName.x", "Size", "FacilityID.x", "FacilityName","FacilityWaterType", "SamplePointID", "SamplePointName", "SamplePointType", "AssociatedFacilityID", "AssociatedSamplePointID", "CollectionDate", "SampleID", "Contaminant", "MRL", "MethodID", "AnalyticalResultsSign", "AnalyticalResultValue", "SampleEventCode", "MonitoringRequirement", "Region", "State.x", "PWSID_facilityID.x", "PWSID_facilty_water", "Treatment", "Biofiltration", "GAC", "EPA_Region", "Geography_type", "PCounty", "LAT", "LONG", "GEOLOCATED", "Status_id", "PWSType", "GwSw", "PSource", "Owner", "SizeCat5_pt", "SizeCat11_pt", "RetPopSrvd", "PWSSvcConn", "GrantEligible", "Contact", "ContactOrgName", "ContactPhone", "ContactAddress1", "ContactAddress2", "ContactCity", "ContactState", "ContactZIP"))

	names(final_data_regdet)[names(final_data_regdet)=="PWSName.x"] <- "PWSName"
	names(final_data_regdet)[names(final_data_regdet)=="FacilityID.x"] <- "FacilityID"
	names(final_data_regdet)[names(final_data_regdet)=="State.x"] <- "State"
	names(final_data_regdet)[names(final_data_regdet)=="PWSID_facilityID.x"] <- "PWSID_facilityID"
	

	View(final_data_regdet)


# combine PWSID and FacilityID to create a unique ID per facility
#	final_data_regdet$PWSID_facilityID <- paste(final_data_regdet$PWSID, final_data_regdet$FacilityID, sep="")
	#View(final_data_regdet)

# Find out how many unique PWSIDs were in each data set
#	UCMR3_unique_PWSIDs <- length(unique(UCMR3_allData$PWSID)) # 6,200
#	UCMR4_TI_unique_PWSIDs <- length(unique(PWSID_TreatmentInfo$PWSID)) # 4,415
#	UCMR4_DT_unique_PWSIDs <- length(unique(PWSID_DisinfectantType$PWSID)) # 4,456
#	UCMR4_DR_unique_PWSIDs <- length(unique(PWSID_DisinfectantResidual$PWSID)) # 4,434
#	UCMR4_HAA_unique_PWSIDs <- length(unique(UCMR4_HAA_AddtlDataElem$PWSID)) # 4,467
#	final_data_unique_PWSIDs <- length(unique(final_data$PWSID)) # 3,564
#	final_data_regdet_unique_PWSIDs <- length(unique(final_data_regdet$PWSID)) # 3,386
	
#	final_data_regdet_unique_PWSID_FacilityID <- unique(subset(final_data_regdet, select = c("PWSID_facilityID", "PWSID", "PWSName", "Size", "FacilityID", "FacilityName", "FacilityWaterType", "Region", "State", "DisinfectantType", "DisinfectantResidual", "Treatment", "Biofiltration")))
	#View(final_data_regdet_unique_PWSID_FacilityID) # This accounts for all unique facilities that have reported sample data for the reg det contaminants

# Begin nondetect (ND) handling

	# If there is an NA in the Analytical column, make it:
			
			# a zero
				final_data_zero <- final_data_regdet
				final_data_zero$AnalyticalResultValue <- na_replace(final_data_zero$AnalyticalResultValue, 0.00)
				final_data_zero$NondetectHandling <- "zero"
				#View(final_data_zero)

					# dioxane
						final_data_zero_dioxane <- dplyr::filter(final_data_zero, Contaminant == "1,4-dioxane")
						
					# PFOS
						final_data_zero_PFOS <- dplyr::filter(final_data_zero, Contaminant == "PFOS")
					
					# PFOA
						final_data_zero_PFOA <- dplyr::filter(final_data_zero, Contaminant == "PFOA")
					
					# strontium
						final_data_zero_strontium <- dplyr::filter(final_data_zero, Contaminant == "strontium")
						
					# trichloropropane
						final_data_zero_trichloropropane <- dplyr::filter(final_data_zero, Contaminant == "1,2,3-trichloropropane")
						

			# equal to the MRL

					# 1,4-dioxane (MRL of 0.07)
						final_data_dioxane <- dplyr::filter(final_data_regdet, Contaminant == "1,4-dioxane")
						final_data_MRL_dioxane <- final_data_dioxane
						final_data_MRL_dioxane$AnalyticalResultValue <- na_replace(final_data_MRL_dioxane$AnalyticalResultValue, 0.07)
						final_data_MRL_dioxane$NondetectHandling <- "MRL"
						#View(final_data_MRL_dioxane)
					# PFOS (MRL of 0.04)
						final_data_PFOS <- dplyr::filter(final_data_regdet, Contaminant == "PFOS")
						final_data_MRL_PFOS <- final_data_PFOS
						final_data_MRL_PFOS$AnalyticalResultValue <- na_replace(final_data_MRL_PFOS$AnalyticalResultValue, 0.04)
						final_data_MRL_PFOS$NondetectHandling <- "MRL"
						#View(final_data_MRL_PFOS)
					# PFOA (MRL of 0.02)
						final_data_PFOA <- dplyr::filter(final_data_regdet, Contaminant == "PFOA")
						final_data_MRL_PFOA <- final_data_PFOA
						final_data_MRL_PFOA$AnalyticalResultValue <- na_replace(final_data_MRL_PFOA$AnalyticalResultValue, 0.02)
						final_data_MRL_PFOA$NondetectHandling <- "MRL"
						#View(final_data_MRL_PFOA)
					# strontium (MRL of 0.30)
						final_data_strontium <- dplyr::filter(final_data_regdet, Contaminant == "strontium")
						final_data_MRL_strontium <- final_data_strontium
						final_data_MRL_strontium$AnalyticalResultValue <- na_replace(final_data_MRL_strontium$AnalyticalResultValue, 0.30)
						final_data_MRL_strontium$NondetectHandling <- "MRL"
						#View(final_data_MRL_strontium)
					# 1,2,3-trichloropropane (MRL of 0.03)
						final_data_trichloropropane <- dplyr::filter(final_data_regdet, Contaminant == "1,2,3-trichloropropane")
						final_data_MRL_trichloropropane <- final_data_trichloropropane
						final_data_MRL_trichloropropane$AnalyticalResultValue <- na_replace(final_data_MRL_trichloropropane$AnalyticalResultValue, 0.03)
						final_data_MRL_trichloropropane$NondetectHandling <- "MRL"
						#View(final_data_MRL_trichloropropane)
					

			# half of the MRL

					# 1,4-dioxane (MRL of 0.07)
						final_data_dioxane <- dplyr::filter(final_data_regdet, Contaminant == "1,4-dioxane")
						final_data_0.5MRL_dioxane <- final_data_dioxane
						final_data_0.5MRL_dioxane$AnalyticalResultValue <- na_replace(final_data_0.5MRL_dioxane$AnalyticalResultValue, 0.07*0.5)
						final_data_0.5MRL_dioxane$NondetectHandling <- "0.5MRL"
						#View(final_data_0.5MRL_dioxane)
					# PFOS (MRL of 0.04)
						final_data_PFOS <- dplyr::filter(final_data_regdet, Contaminant == "PFOS")
						final_data_0.5MRL_PFOS <- final_data_PFOS
						final_data_0.5MRL_PFOS$AnalyticalResultValue <- na_replace(final_data_0.5MRL_PFOS$AnalyticalResultValue, 0.04*0.5)
						final_data_0.5MRL_PFOS$NondetectHandling <- "0.5MRL"
						#View(final_data_0.5MRL_PFOS)
					# PFOA (MRL of 0.02)
						final_data_PFOA <- dplyr::filter(final_data_regdet, Contaminant == "PFOA")
						final_data_0.5MRL_PFOA <- final_data_PFOA
						final_data_0.5MRL_PFOA$AnalyticalResultValue <- na_replace(final_data_0.5MRL_PFOA$AnalyticalResultValue, 0.02*0.5)
						final_data_0.5MRL_PFOA$NondetectHandling <- "0.5MRL"
						#View(final_data_0.5MRL_PFOA)
					# strontium (MRL of 0.30)
						final_data_strontium <- dplyr::filter(final_data_regdet, Contaminant == "strontium")
						final_data_0.5MRL_strontium <- final_data_strontium
						final_data_0.5MRL_strontium$AnalyticalResultValue <- na_replace(final_data_0.5MRL_strontium$AnalyticalResultValue, 0.30*0.5)
						final_data_0.5MRL_strontium$NondetectHandling <- "0.5MRL"
						#View(final_data_0.5MRL_strontium)
					# 1,2,3-trichloropropane (MRL of 0.03)
						final_data_trichloropropane <- dplyr::filter(final_data_regdet, Contaminant == "1,2,3-trichloropropane")
						final_data_0.5MRL_trichloropropane <- final_data_trichloropropane
						final_data_0.5MRL_trichloropropane$AnalyticalResultValue <- na_replace(final_data_0.5MRL_trichloropropane$AnalyticalResultValue, 0.03*0.5)
						final_data_0.5MRL_trichloropropane$NondetectHandling <- "0.5MRL"
						#View(final_data_0.5MRL_trichloropropane)

			# quarter of the MRL
				
					# 1,4-dioxane (MRL of 0.07)
						final_data_dioxane <- dplyr::filter(final_data_regdet, Contaminant == "1,4-dioxane")
						final_data_0.25MRL_dioxane <- final_data_dioxane
						final_data_0.25MRL_dioxane$AnalyticalResultValue <- na_replace(final_data_0.25MRL_dioxane$AnalyticalResultValue, 0.07*0.25)
						final_data_0.25MRL_dioxane$NondetectHandling <- "0.25MRL"
						#View(final_data_0.25MRL_dioxane)
					# PFOS (MRL of 0.04)
						final_data_PFOS <- dplyr::filter(final_data_regdet, Contaminant == "PFOS")
						final_data_0.25MRL_PFOS <- final_data_PFOS
						final_data_0.25MRL_PFOS$AnalyticalResultValue <- na_replace(final_data_0.25MRL_PFOS$AnalyticalResultValue, 0.04*0.25)
						final_data_0.25MRL_PFOS$NondetectHandling <- "0.25MRL"
						#View(final_data_0.25MRL_PFOS)
					# PFOA (MRL of 0.02)
						final_data_PFOA <- dplyr::filter(final_data_regdet, Contaminant == "PFOA")
						final_data_0.25MRL_PFOA <- final_data_PFOA
						final_data_0.25MRL_PFOA$AnalyticalResultValue <- na_replace(final_data_0.25MRL_PFOA$AnalyticalResultValue, 0.02*0.25)
						final_data_0.25MRL_PFOA$NondetectHandling <- "0.25MRL"
						#View(final_data_0.25MRL_PFOA)
					# strontium (MRL of 0.30)
						final_data_strontium <- dplyr::filter(final_data_regdet, Contaminant == "strontium")
						final_data_0.25MRL_strontium <- final_data_strontium
						final_data_0.25MRL_strontium$AnalyticalResultValue <- na_replace(final_data_0.25MRL_strontium$AnalyticalResultValue, 0.30*0.25)
						final_data_0.25MRL_strontium$NondetectHandling <- "0.25MRL"
						#View(final_data_0.25MRL_strontium)
					# 1,2,3-trichloropropane (MRL of 0.03)
						final_data_trichloropropane <- dplyr::filter(final_data_regdet, Contaminant == "1,2,3-trichloropropane")
						final_data_0.25MRL_trichloropropane <- final_data_trichloropropane
						final_data_0.25MRL_trichloropropane$AnalyticalResultValue <- na_replace(final_data_0.25MRL_trichloropropane$AnalyticalResultValue, 0.03*0.25)
						final_data_0.25MRL_trichloropropane$NondetectHandling <- "0.25MRL"
						#View(final_data_0.25MRL_trichloropropane)


			# Format data long to graph in ggplot

					# dioxane
						combined_nondetects_dioxane <- rbind(final_data_zero_dioxane, final_data_MRL_dioxane, final_data_0.5MRL_dioxane, final_data_0.25MRL_dioxane)
						#View(combined_nondetects_dioxane)
					# PFOS
						combined_nondetects_PFOS <- rbind(final_data_zero_PFOS, final_data_MRL_PFOS, final_data_0.5MRL_PFOS, final_data_0.25MRL_PFOS)
						#View(combined_nondetects_PFOS)
					# PFOA
						combined_nondetects_PFOA <- rbind(final_data_zero_PFOA, final_data_MRL_PFOA, final_data_0.5MRL_PFOA, final_data_0.25MRL_PFOA)
						#View(combined_nondetects_PFOA)
					# strontium
						combined_nondetects_strontium <- rbind(final_data_zero_strontium, final_data_MRL_strontium, final_data_0.5MRL_strontium, final_data_0.25MRL_strontium)
						#View(combined_nondetects_strontium)
					# trichloropropane
						combined_nondetects_trichloropropane <- rbind(final_data_zero_trichloropropane, final_data_MRL_trichloropropane, final_data_0.5MRL_trichloropropane, final_data_0.25MRL_trichloropropane)
						#View(combined_nondetects_trichloropropane)


	# Plot Empirical Cumulative Distribution Function (ECDF) for nondetects
				# How to read an ECDF? https://towardsdatascience.com/what-why-and-how-to-read-empirical-cdf-123e2b922480

				# Plot ECDF

				

					summary(combined_nondetects_dioxane$AnalyticalResultValue)
					summary(combined_nondetects_PFOS$AnalyticalResultValue)
					summary(combined_nondetects_PFOA$AnalyticalResultValue)
					summary(combined_nondetects_strontium$AnalyticalResultValue)
					summary(combined_nondetects_trichloropropane$AnalyticalResultValue)

				# Dioxane

					ECDF_dioxane <- ggplot(combined_nondetects_dioxane, aes(x = AnalyticalResultValue, group = NondetectHandling, color = NondetectHandling, linetype = NondetectHandling)) + 
							stat_ecdf(geom = "smooth", pad = TRUE) +
							theme_bw() +
							theme(legend.position="top", legend.title = element_blank()) +
							scale_color_nejm() +
							#scale_linetype_identity() +
							#xlim(0.00, 30) +
							ylab(paste("Empirical Cumulative Distribution Function")) +
							xlab("1,4 - Dioxane Concentration (\u03BCg/L)") +
							scale_x_continuous(expand = c(0, 0)) +
							scale_y_continuous(expand = c(0, 0)) +
							coord_cartesian(xlim = c(0.00, 0.80))
					ECDF_dioxane

					#ggsave(ECDF_full, filename = paste("ECDF_full_", Sys.Date(), ".jpeg", sep=""), width=4, height=5, units="in", path = "C:/Users/Andrew/Desktop/AJB_personal/USF/Masters_thesis_word/UCMR_3_dioxane/ECDF")

					# Chose 0.5MRL, as the zero and MRL bias the data lower and higher, respectively


				# PFOS


					ECDF_PFOS <- ggplot(combined_nondetects_PFOS, aes(x = AnalyticalResultValue, group = NondetectHandling, color = NondetectHandling, linetype = NondetectHandling)) + 
							stat_ecdf(geom = "smooth", pad = TRUE) +
							theme_bw() +
							theme(legend.position="top", legend.title = element_blank()) +
							scale_color_nejm() +
							#scale_linetype_identity() +
							#xlim(0.00, 30) +
							ylab(paste("Empirical Cumulative Distribution Function")) +
							xlab("1,4 - PFOS Concentration (\u03BCg/L)") +
							scale_x_continuous(expand = c(0, 0)) +
							scale_y_continuous(expand = c(0, 0)) +
							coord_cartesian(xlim = c(0.00, 0.20))
					ECDF_PFOS

					#ggsave(ECDF_full, filename = paste("ECDF_full_", Sys.Date(), ".jpeg", sep=""), width=4, height=5, units="in", path = "C:/Users/Andrew/Desktop/AJB_personal/USF/Masters_thesis_word/UCMR_3_dioxane/ECDF")

					# Chose 0.5MRL, as the zero and MRL bias the data lower and higher, respectively

				# PFOA

					ECDF_PFOA <- ggplot(combined_nondetects_PFOA, aes(x = AnalyticalResultValue, group = NondetectHandling, color = NondetectHandling, linetype = NondetectHandling)) + 
							stat_ecdf(geom = "smooth", pad = TRUE) +
							theme_bw() +
							theme(legend.position="top", legend.title = element_blank()) +
							scale_color_nejm() +
							#scale_linetype_identity() +
							#xlim(0.00, 30) +
							ylab(paste("Empirical Cumulative Distribution Function")) +
							xlab("1,4 - PFOA Concentration (\u03BCg/L)") +
							scale_x_continuous(expand = c(0, 0)) +
							scale_y_continuous(expand = c(0, 0)) +
							coord_cartesian(xlim = c(0.00, 0.05))
					ECDF_PFOA

					#ggsave(ECDF_full, filename = paste("ECDF_full_", Sys.Date(), ".jpeg", sep=""), width=4, height=5, units="in", path = "C:/Users/Andrew/Desktop/AJB_personal/USF/Masters_thesis_word/UCMR_3_dioxane/ECDF")

					# Chose 0.5MRL, as the zero and MRL bias the data lower and higher, respectively

				# strontium

					ECDF_strontium <- ggplot(combined_nondetects_strontium, aes(x = AnalyticalResultValue, group = NondetectHandling, color = NondetectHandling, linetype = NondetectHandling)) + 
							stat_ecdf(geom = "smooth", pad = TRUE) +
							theme_bw() +
							theme(legend.position="top", legend.title = element_blank()) +
							scale_color_nejm() +
							#scale_linetype_identity() +
							#xlim(0.00, 30) +
							ylab(paste("Empirical Cumulative Distribution Function")) +
							xlab("1,4 - strontium Concentration (\u03BCg/L)") +
							scale_x_continuous(expand = c(0, 0)) +
							scale_y_continuous(expand = c(0, 0)) +
							coord_cartesian(xlim = c(0.00, 0.5), ylim = c(0.00, 0.01))
					ECDF_strontium

					#ggsave(ECDF_full, filename = paste("ECDF_full_", Sys.Date(), ".jpeg", sep=""), width=4, height=5, units="in", path = "C:/Users/Andrew/Desktop/AJB_personal/USF/Masters_thesis_word/UCMR_3_dioxane/ECDF")

					# Chose 0.5MRL, as the zero and MRL bias the data lower and higher, respectively

				# trichloropropane

					ECDF_trichloropropane <- ggplot(combined_nondetects_trichloropropane, aes(x = AnalyticalResultValue, group = NondetectHandling, color = NondetectHandling, linetype = NondetectHandling)) + 
							stat_ecdf(geom = "smooth", pad = TRUE) +
							theme_bw() +
							theme(legend.position="top", legend.title = element_blank()) +
							scale_color_nejm() +
							#scale_linetype_identity() +
							#xlim(0.00, 30) +
							ylab(paste("Empirical Cumulative Distribution Function")) +
							xlab("1,4 - trichloropropane Concentration (\u03BCg/L)") +
							scale_x_continuous(expand = c(0, 0)) +
							scale_y_continuous(expand = c(0, 0)) +
							coord_cartesian(xlim = c(0.00, 0.05))
					ECDF_trichloropropane

					#ggsave(ECDF_full, filename = paste("ECDF_full_", Sys.Date(), ".jpeg", sep=""), width=4, height=5, units="in", path = "C:/Users/Andrew/Desktop/AJB_personal/USF/Masters_thesis_word/UCMR_3_dioxane/ECDF")

					# Chose 0.5MRL, as the zero and MRL bias the data lower and higher, respectively

# Choose an MRL per contaminant, then use that dataframe below (use 0.5MRL):

		# First, combine the contaminant dataframes, wide, by PWSID_facilityID. Then, use melt to get them in long format
		












# Take 95th percentile of AnalyticalResultValue for each PWSID_facilityID, and include particular columns
				
			# create the 95th percentile function
				percentile95 <- function (x){
					quantile(x, probs = 0.95)
				}

			
			# create the new data sets

			# dioxane	

				s95th_dioxane <- aggregate(x = final_data_0.5MRL_dioxane$AnalyticalResultValue,     # Specify data column
				          by = list(final_data_0.5MRL_dioxane$PWSID_facilityID),                          # Specify group indicator
				          FUN = percentile95)                                            # Specify function (i.e. mean)
				colnames(s95th_dioxane) <- c("PWSID_facilityID", "s95thAnalyticalResultValue_dioxane")
				View(s95th_dioxane)



			# PFOS	

				s95th_PFOS <- aggregate(x = final_data_0.5MRL_PFOS$AnalyticalResultValue,     # Specify data column
				          by = list(final_data_0.5MRL_PFOS$PWSID_facilityID),                          # Specify group indicator
				          FUN = percentile95)                                            # Specify function (i.e. mean)
				colnames(s95th_PFOS) <- c("PWSID_facilityID", "s95thAnalyticalResultValue_PFOS")
				View(s95th_PFOS)


			# PFOA

				s95th_PFOA <- aggregate(x = final_data_0.5MRL_PFOA$AnalyticalResultValue,     # Specify data column
				          by = list(final_data_0.5MRL_PFOA$PWSID_facilityID),                          # Specify group indicator
				          FUN = percentile95)                                            # Specify function (i.e. mean)
				colnames(s95th_PFOA) <- c("PWSID_facilityID", "s95thAnalyticalResultValue_PFOA")
				View(s95th_PFOA)


			# strontium

				s95th_strontium <- aggregate(x = final_data_0.5MRL_strontium$AnalyticalResultValue,     # Specify data column
				          by = list(final_data_0.5MRL_strontium$PWSID_facilityID),                          # Specify group indicator
				          FUN = percentile95)                                            # Specify function (i.e. mean)
				colnames(s95th_strontium) <- c("PWSID_facilityID", "s95thAnalyticalResultValue_strontium")
				View(s95th_strontium)


			# trichloropropane

				s95th_trichloropropane <- aggregate(x = final_data_0.5MRL_trichloropropane$AnalyticalResultValue,     # Specify data column
				          by = list(final_data_0.5MRL_trichloropropane$PWSID_facilityID),                          # Specify group indicator
				          FUN = percentile95)                                            # Specify function (i.e. mean)
				colnames(s95th_trichloropropane) <- c("PWSID_facilityID", "s95thAnalyticalResultValue_trichloropropane")
				View(s95th_trichloropropane)

	# Combine each of the above with a copy of final_data_regdet, copying columns over based on PWSID_facilityID listed in each s95th data set

		# First, subset final_data_regdet to just facility data info
			dput(as.character(names(final_data_regdet)))
			facility_data_end <- unique(subset(final_data_regdet, select = c("PWSID", "PWSName", "Size", "FacilityID", "FacilityName", "FacilityWaterType", "Region", "State", "PWSID_facilityID", "Treatment", "Biofiltration", "GAC", "EPA_Region", "Geography_type", "PCounty", "LAT", "LONG", "GEOLOCATED", "Status_id", "PWSType", "GwSw", "PSource", "Owner", "SizeCat5_pt", "SizeCat11_pt", "RetPopSrvd", "PWSSvcConn", "GrantEligible", "Contact", "ContactOrgName", "ContactPhone", "ContactAddress1", "ContactAddress2", "ContactCity", "ContactState", "ContactZIP")))
			View(facility_data_end)
		# Now, add in each 95th data set as new columns, KEEPING ALL DATA
			d1 <- merge(x=facility_data_end, y=s95th_dioxane, by="PWSID_facilityID", all=TRUE)
			d2 <- merge(x=d1, y=s95th_PFOA, by="PWSID_facilityID", all=TRUE)
			d3 <- merge(x=d2, y=s95th_PFOS, by="PWSID_facilityID", all=TRUE)
			d4 <- merge(x=d3, y=s95th_strontium, by="PWSID_facilityID", all=TRUE)
			final_95th_wide <- merge(x=d4, y=s95th_trichloropropane, by="PWSID_facilityID", all=TRUE)

			View(final_95th_wide)

			final_95th_long <- melt(final_95th_wide,
				id.vars = c("PWSID", "PWSName", "Size", "FacilityID", "FacilityName", "FacilityWaterType", "Region", "State", "PWSID_facilityID", "Treatment", "Biofiltration", "GAC", "EPA_Region", "Geography_type", "PCounty", "LAT", "LONG", "GEOLOCATED", "Status_id", "PWSType", "GwSw", "PSource", "Owner", "SizeCat5_pt", "SizeCat11_pt", "RetPopSrvd", "PWSSvcConn", "GrantEligible", "Contact", "ContactOrgName", "ContactPhone", "ContactAddress1", "ContactAddress2", "ContactCity", "ContactState", "ContactZIP"), 
				measure.vars = c("s95thAnalyticalResultValue_trichloropropane","s95thAnalyticalResultValue_dioxane","s95thAnalyticalResultValue_PFOS", "s95thAnalyticalResultValue_PFOA", "s95thAnalyticalResultValue_strontium"))
			

			# remove rows that have NA in "value", because these were already replaced in the NA replace section. . . currently at 96,470 rows, dropping down to:
			final_95th_long <- final_95th_long[!is.na(final_95th_long$value),]
			View(final_95th_long) # down to 70,112 rows now



# Lets get mapping!

	# Start with final_95th_long, and make PCounty data into a new column called "subregion", and make the entry lowercase entries of PCounty
		final_95th_long$subregion <- tolower(final_95th_long$PCounty)

	# Subset to get only the data we need to map by subregion (****** combine data per subregion with s95th function****)
		heatmap_by_county_data <- subset(final_95th_long, select = c("variable", "value", "State", "subregion"))
		head(heatmap_by_county_data)
# load map outline data
	us_counties <- map_data("county")
	head(us_counties)


# biofilter/GAC location data for entire US from all UCMR4 data:
			treatment_data <- subset(final_data_latlong, select = c("PWSID_facilityID.x", "LAT", "LONG", "Biofiltration", "GAC"))
			treatment_data <- unique(treatment_data)
			View(treatment_data) # 22,736 facilities
			treatment_data_BF <- dplyr::filter(treatment_data, Biofiltration == TRUE) # 405 facilities in the US with BF
			treatment_data_BF <- unique(treatment_data_BF)
			View(treatment_data_BF)
			treatment_data_GAC <- dplyr::filter(treatment_data, GAC == TRUE)
			treatment_data_GAC <- unique(treatment_data_GAC)
			View(treatment_data_GAC) # 2,007 facilities with GAC in the US

			# just with unique coordinates, for mapping purposes:
			treatment_data_to_map_BF <- unique(subset(treatment_data_BF, select = c("LAT", "LONG", "Biofiltration")))
			View(treatment_data_to_map_BF) # 72 coordinates with known BF
			treatment_data_to_map_GAC <- unique(subset(treatment_data_GAC, select = c("LAT", "LONG", "GAC")))
			treatment_data_to_map_GAC <- filter(treatment_data_to_map_GAC, LONG > -150)
			View(treatment_data_to_map_GAC) # 239 coordinates with known GAC

# combine this with the data we want to show	
	
	# Dioxane
		dioxane_map_data <- dplyr::filter(heatmap_by_county_data, variable == "s95thAnalyticalResultValue_dioxane")
		dioxane_map_data <- aggregate(dioxane_map_data$value, by = list(dioxane_map_data$subregion), FUN = mean)
		dioxane_map_data$subregion <- dioxane_map_data$Group.1
		dioxane_map_data$value <- dioxane_map_data$x
		dioxane_map_data <- left_join(us_counties, dioxane_map_data, by= "subregion")
		dioxane_map_data$exceeds_MRL <- dioxane_map_data$value > 0.07 # MRL for dioxane
		dioxane_map_data$value_that_exceeded_MRL <- ifelse(dioxane_map_data$value > 0.035, dioxane_map_data$value, NA) # if value exceeds half the MRL for a county, then a value for that county was reported above the MRL, so dioxane was found in that county
		dioxane_map_data$exceeds_limit <- dioxane_map_data$value > 1 # limit for dioxane is 1 ug/L, based on NY MCL
		View(dioxane_map_data)

	# PFOS
		PFOS_map_data <- dplyr::filter(heatmap_by_county_data, variable == "s95thAnalyticalResultValue_PFOS")
		PFOS_map_data <- aggregate(PFOS_map_data$value, by = list(PFOS_map_data$subregion), FUN = mean)
		PFOS_map_data$subregion <- PFOS_map_data$Group.1
		PFOS_map_data$value <- PFOS_map_data$x
		PFOS_map_data <- left_join(us_counties, PFOS_map_data, by= "subregion")
		PFOS_map_data$exceeds_MRL <- PFOS_map_data$value > 0.04 # MRL for PFOS
		PFOS_map_data$exceeds_limit <- PFOS_map_data$value > 0.010 # The current lowest, NY advisory/standard
		View(PFOS_map_data)

	# PFOA
		PFOA_map_data <- dplyr::filter(heatmap_by_county_data, variable == "s95thAnalyticalResultValue_PFOA")
		PFOA_map_data <- aggregate(PFOA_map_data$value, by = list(PFOA_map_data$subregion), FUN = mean)
		PFOA_map_data$subregion <- PFOA_map_data$Group.1
		PFOA_map_data$value <- PFOA_map_data$x
		PFOA_map_data <- left_join(us_counties, PFOA_map_data, by= "subregion")

		# for (value in PFOA_map_data$value) { if (PFOA_map_data$value > 0.0065){ # this is California notification level
  #   		PFOA_map_data$value_exceeded <- "6.5"
		# 	} else if (PFOA_map_data$value > 0.008){
  #   			PFOA_map_data$value_exceeded <- "8"
		# 	} else {
		# 		PFOA_map_data$value_exceeded <- "Does not exceed"
		# 	}
		# }

		#PFOA_map_data$value_exceeded <- ifelse(PFOA_map_data$value > 0.0065, ifelse(PFOA_map_data$value > 0.008))
		PFOA_map_data$exceeds_limit <- PFOA_map_data$value > 0.008 # Current lowest, Michigan's new enforceable
		PFOA_map_data$exceeds_MRL <- PFOA_map_data$value > 0.02 # MRL for PFOA
		View(PFOA_map_data)

	# trichloropropane
		trichloropropane_map_data <- dplyr::filter(heatmap_by_county_data, variable == "s95thAnalyticalResultValue_trichloropropane")
		trichloropropane_map_data <- aggregate(trichloropropane_map_data$value, by = list(trichloropropane_map_data$subregion), FUN = mean)
		trichloropropane_map_data$subregion <- trichloropropane_map_data$Group.1
		trichloropropane_map_data$value <- trichloropropane_map_data$x
		trichloropropane_map_data <- left_join(us_counties, trichloropropane_map_data, by= "subregion")
		trichloropropane_map_data$exceeds_MRL <- trichloropropane_map_data$value > 0.03 # MRL for trichloropropane
		trichloropropane_map_data$exceeds_limit <- trichloropropane_map_data$value > 0.00003 # 3 x 10^-5 ug/L in Texas
		View(trichloropropane_map_data)

	# strontium
		strontium_map_data <- dplyr::filter(heatmap_by_county_data, variable == "s95thAnalyticalResultValue_strontium")
		strontium_map_data <- aggregate(strontium_map_data$value, by = list(strontium_map_data$subregion), FUN = mean)
		strontium_map_data$subregion <- strontium_map_data$Group.1
		strontium_map_data$value <- strontium_map_data$x
		strontium_map_data <- left_join(us_counties, strontium_map_data, by= "subregion")
		dioxane_map_data$exceeds_limit <- dioxane_map_data$value > 1 # limit for dioxane is 1 ug/L, based on NY MCL
		View(strontium_map_data)

# map it

	# heatmap of dioxane with biofilter locations shown

		ggplot(dioxane_map_data, aes(x=long,y=lat,group=group, fill=value_that_exceeded_MRL)) +
			geom_polygon(color = "gray90", size = 0.1) +
			coord_map(projection = "albers", lat0 = 45, lat1 = 55)  +
			scale_fill_continuous(type = "viridis") +
	  		theme(legend.position="bottom",
		        axis.line=element_blank(),
		        axis.text=element_blank(),
		        axis.ticks=element_blank(),
		        axis.title=element_blank(),
		        panel.background=element_blank(),
		        panel.border=element_blank(),
		        panel.grid=element_blank())
	  		

	  	dioxane_detects_w_BF <- ggplot(data = dioxane_map_data) +
							  		geom_polygon(aes(x = long,y = lat, group = group, fill=value_that_exceeded_MRL), color = "gray90", size = 0.1)  +
									coord_map(projection = "albers", lat0 = 45, lat1 = 55) +
							  		theme(legend.position="bottom",
								        axis.line=element_blank(),
								        axis.text=element_blank(),
								        axis.ticks=element_blank(),
								        axis.title=element_blank(),
								        panel.background=element_blank(),
								        panel.border=element_blank(),
								        panel.grid=element_blank())+
							  		geom_point(data = treatment_data_to_map_BF, shape = 21, colour = "black", fill = "yellow", size = 3, aes(x = LONG, y = LAT))
			dioxane_detects_w_BF

		dioxane_detects_w_GAC <- ggplot(data = dioxane_map_data) +
							  		geom_polygon(aes(x = long,y = lat, group = group, fill=value_that_exceeded_MRL), color = "gray90", size = 0.1)  +
									coord_map(projection = "albers", lat0 = 45, lat1 = 55) +
							  		theme(legend.position="bottom",
								        axis.line=element_blank(),
								        axis.text=element_blank(),
								        axis.ticks=element_blank(),
								        axis.title=element_blank(),
								        panel.background=element_blank(),
								        panel.border=element_blank(),
								        panel.grid=element_blank())+
							  		geom_point(data = treatment_data_to_map_GAC, shape = 21, colour = "black", fill = "green", size = 3, aes(x = LONG, y = LAT))
			dioxane_detects_w_GAC


	
	# Multiple plot function

			# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
			# - cols:   Number of columns in layout
			# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
			#
			# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
			# then plot 1 will go in the upper left, 2 will go in the upper right, and
			# 3 will go all the way across the bottom.
			#
			multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
			  require(grid)

			  # Make a list from the ... arguments and plotlist
			  plots <- c(list(...), plotlist)

			  numPlots = length(plots)

			  # If layout is NULL, then use 'cols' to determine layout
			  if (is.null(layout)) {
			    # Make the panel
			    # ncol: Number of columns of plots
			    # nrow: Number of rows needed, calculated from # of cols
			    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
			                    ncol = cols, nrow = ceiling(numPlots/cols))
			  }

			 if (numPlots==1) {
			    print(plots[[1]])

			  } else {
			    # Set up the page
			    grid.newpage()
			    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

			    # Make each plot, in the correct location
			    for (i in 1:numPlots) {
			      # Get the i,j matrix positions of the regions that contain this subplot
			      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

			      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
			                                      layout.pos.col = matchidx$col))
			    }
			  }
			}

	# exceeds MRL

		
	p1 <-	ggplot(dioxane_map_data, aes(x=long,y=lat,group=group, fill=exceeds_MRL)) +
			  geom_polygon(color = "gray90", size = 0.1) +
			  #coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
			  coord_map(projection = "albers", lat0 = 45, lat1 = 55) +
			  theme(legend.position="bottom",
			        axis.line=element_blank(),
			        axis.text=element_blank(),
			        axis.ticks=element_blank(),
			        axis.title=element_blank(),
			        panel.background=element_blank(),
			        panel.border=element_blank(),
			        panel.grid=element_blank()) +
			  labs(title="Dioxane")

	p2 <-	ggplot(PFOA_map_data, aes(x=long,y=lat,group=group, fill=exceeds_MRL)) +
			  geom_polygon(color = "gray90", size = 0.1) +
			  #coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
			  coord_map(projection = "albers", lat0 = 45, lat1 = 55) +
			  theme(legend.position="bottom",
			        axis.line=element_blank(),
			        axis.text=element_blank(),
			        axis.ticks=element_blank(),
			        axis.title=element_blank(),
			        panel.background=element_blank(),
			        panel.border=element_blank(),
			        panel.grid=element_blank()) +
			  labs(title="PFOA")

	p3 <-	ggplot(PFOS_map_data, aes(x=long,y=lat,group=group, fill=exceeds_MRL)) +
			  geom_polygon(color = "gray90", size = 0.1) +
			  #coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
			  coord_map(projection = "albers", lat0 = 45, lat1 = 55) +
			  theme(legend.position="bottom",
			        axis.line=element_blank(),
			        axis.text=element_blank(),
			        axis.ticks=element_blank(),
			        axis.title=element_blank(),
			        panel.background=element_blank(),
			        panel.border=element_blank(),
			        panel.grid=element_blank()) +
			  labs(title="PFOS")

	p4 <-	ggplot(trichloropropane_map_data, aes(x=long,y=lat,group=group, fill=exceeds_MRL)) +
			  geom_polygon(color = "gray90", size = 0.1) +
			  #coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
			  coord_map(projection = "albers", lat0 = 45, lat1 = 55) +
			  theme(legend.position="bottom",
			        axis.line=element_blank(),
			        axis.text=element_blank(),
			        axis.ticks=element_blank(),
			        axis.title=element_blank(),
			        panel.background=element_blank(),
			        panel.border=element_blank(),
			        panel.grid=element_blank()) +
			  labs(title="TCP")

	
	#multiplot(p1, p2, p3, p4, cols=2)

	p1
	p2
	p3
	p4



